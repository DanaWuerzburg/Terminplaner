<%= render 'appointments/nav' %>
<div id="settings">
  <div id="groups">
    <div class="field">
        <% @groups.each do |group| %>
        <div>
            <input class="picker color{valueElement:'<%= group.name %>'}" />
            <input id ="<%= group.name %>" style="display: none" value="<%= group.colour %>" onchange=""/>
            <a class="colorlabel" href><%= group.name %></a>
        </div>
        <% end %>
        <%= render :partial => "groups/form" %>
        </div>
    </div>

</div>
<div id="cont">
<section class="appointments">
   <h1><%= current_user.login %>'s Agenda</h1>

   <section class="reminder">

      <!--<div id="zeit"> <#%= "{#:method=>'zeit'}" %> </div>-->
      <h4>Today: <%= Time.now.strftime('%d. %B %Y') %>


      </h4>


      <ul>
      <% @appointments.reverse.each do |appointment| %>
          <% if appointment.date.strftime('%y%m%d') == Time.now.strftime('%y%m%d') && appointment.date.strftime('%H') > Time.now.strftime('%H')%>
            <li><%= appointment.date.strftime('%H:%M') + ": " %><%= link_to truncate(appointment.note.to_s, :length => 90, :separator => ' ') , appointment, :popup=> true, :title=>"Show more" %></li>

          <% end %>
      <% end %>
      </ul>
  </section>
<table class="pretty">
  <thead>
    <th class="group"></th>
    <th><%= sortable "date" %></th>
    <th><%= sortable "note","Note" %></th>
    <th><%= sortable "priority_number","Priority" %></th>
    <!--ADMINFIELD -->
    <% if current_user.admin? %>
        <th>Group ID</th>
        <th><%= sortable "ID", "ID"%></th>
        <th><%= sortable "user_id","User ID" %></th>
    <% end %>

     <!-- Adminfield ende -->

  </thead>
  <tbody>

    <% @appointments.each do |appointment| %>

    <tr>

    <td class="group" style="background-color: <%= appointment.group.colour %>"></td>
    <td><%= appointment.date.strftime('%d.%m.%y %H:%M') %></td>
    <td><%= appointment.note %></td>
    <td><%= appointment.priority_number %></td>
    <!---->
    <% if current_user.admin? %>
        <td><%= appointment.group_id%></td>
        <td><%= appointment.id %></td>
        <td><%= appointment.user_id %></td>
    <% end %>

     <!-- Adminfield ende -->

    <td></td>
    <td class="tdtools">
      <!-- # User kann nur seine eigenen appointments editieren #-->
       <% if current_user.id == appointment.user_id || current_user.admin? %>
          <%= link_to '', edit_appointment_path(appointment), class: 'button left edit', title: 'Edit Appointment'  %>
          <%= link_to '', appointment, confirm: 'Are you sure?', method: :delete, class: 'button right delete', title: 'Delete Appointment' %>
       <% end%>
    </td>
  </tr>
<% end %>
    </tbody>
</table>



   <div class="padded-body">
  <h2>Generate and Download Sample XML Document</h2>
  <p>Clicking on one of these links will generate the sample XML file we're going to be
    using for this tutorial. One link will generate the XML using REXML, and the other link
    using Builder. I'll leave it as an exercise for the reader to figure out which link does what.</p>
  <div style="text-align: center;">
    <%=link_to "download as in index", :action => "generate_with_rexml" %>

  </div>
</div>


<div class="padded-body">
  <h2>Upload the Sample XML Document, Parse and Manipulate</h2>
  <p>This form lets you upload the Sample XML document that we generated above and
    parse its content with both REXML and Hpricot.</p>
  <p>
    <% form_tag( {:action => 'upload'}, {:multipart => true} ) do -%>
         <p>
        <label for="file">File:</label><%= file_field_tag "xml_file" %><br/>
        <%= submit_tag "Parse with REXML", :action => "parse_with_rexml" %>
        <%= submit_tag ("Parse with REXML recursively") %>
        </p>
     <% end -%>
 </p>
</div>
</section>






<section class="newappointment">
<h1>New Appointment</h1>
   <div class="formular">

        <%= render 'form' %>
</div>
    <section class="notify">
        <%= flash[:notice] %>
    </section>
</section>

</div>
