<%= render 'appointments/nav' %>
<div id="settings">
  <div id="groups">
    <div class="field">
        <% @groups.each do |group| %>
        <div>
            <input class="picker color {valueElement:'<%= group.name %>'}" />
            <input id ="<%= group.name %>" style="display: none" value="<%= group.colour %>" onchange=""/>
            <a class="colorlabel" href><%= group.name %></a>
        </div>
        <% end %>
    </div>

  <%= render :partial => "groups/form" %>
  </div>

</div>
<div id="cont">
<section class="appointments">
   <h1><%= current_user.login %>'s Agenda</h1>
   <section class="notify">
   <%= flash[:notice] %>
   </section>
   <section class="reminder">
      <!--<div id="zeit"> <#%= "{#:method=>'zeit'}" %> </div>-->
      <h4>Appointments for today: <%= Time.now.strftime('%d. %B %Y') %></h4>
      <ul>
      <% @appointments.each do |appointment| %>
      <% String st = appointment.date.strftime('%d.%m.%y') %>
          <% if st == Time.now.strftime('%d.%m.%y') %>
            <li><%= link_to truncate(appointment.note.to_s, :length => 90, :separator => ' ') , appointment, :popup=> true, :title=>"Show more" %></li>
          <% end %>
      <% end %>
      </ul>
  </section>
<table class="pretty">
  <thead>
    <th class="group"></th>
    <th><%= sortable "date" %></th>
    <th><%= sortable "note","Note" %></th>
    <th><%= sortable "priority_number","Priority" %></th>
    <th>Group ID</th>

        <!-- ADMINFIELD  -->
    <% if current_user.admin? %>
        <th><%= sortable "ID", "ID"%></th>
        <th><%= sortable "user_id","User ID" %></th>
    <% end %>

     <!-- Adminfield ende -->

  </thead>
  <tbody>
<% @appointments.each do |appointment| %>

    <tr>

    <td class="group" style="background-color: <%= appointment.group.colour %>"></td>
    <td><%= appointment.date.strftime('%d.%m.%y %H:%M') %></td>
    <td><%= appointment.note %></td>
    <td><%= appointment.priority_number %></td>
     <td><%= appointment.group_id%></td>
              <!-- ADMINFIELD  -->
    <% if current_user.admin? %>
        <td><%= appointment.id %></td>
        <td><%= appointment.user_id %></td>
    <% end %>

     <!-- Adminfield ende -->

    <td></td>
    <td class="tdtools">
      <!-- # User kann nur seine eigenen appointments editieren #-->
       <% if current_user.id == appointment.user_id || current_user.admin? %>
          <%= link_to '', edit_appointment_path(appointment), class: 'button left edit', title: 'Edit Appointment'  %>
          <%= link_to '', appointment, confirm: 'Are you sure?', method: :delete, class: 'button right delete', title: 'Delete Appointment' %>
       <% end%>
    </td>
  </tr>
<% end %>
    </tbody>
</table>
</section>






<section class="newappointment">
<h1>New Appointment</h1>
   <div class="formular">

        <%= render 'form' %>
</div>
</section>
</div>
<footer>

</footer>
